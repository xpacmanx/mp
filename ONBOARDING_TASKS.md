# Onboarding для новых пользователей

Система onboarding для пользователей, которые входят в систему впервые. Определение новых пользователей происходит по наличию заполненной даты рождения.

## Логика работы

- Если дата рождения НЕ заполнена → показываем onboarding
- Если дата рождения заполнена → onboarding не нужен
- После заполнения даты рождения → onboarding автоматически скрывается

## Completed Tasks

- [x] Создать компонент OnboardingModal.vue с 4 шагами
- [x] Создать компонент OnboardingManager.vue для управления onboarding
- [x] Интегрировать OnboardingManager в App.vue
- [x] Реализовать шаг 1: Смена пароля
- [x] Реализовать шаг 2: Заполнение личной информации (имя, фамилия, дата рождения)
- [x] Реализовать шаг 3: Загрузка фото профиля
- [x] Реализовать шаг 4: Приветствие и завершение
- [x] Добавить возможность пропуска шагов
- [x] Добавить навигацию между шагами (назад/вперед)
- [x] Интегрировать с существующим ProfileImageCropper
- [x] Добавить сохранение данных на сервер через API
- [x] Добавить обновление userState после сохранения данных

## Completed Tasks

- [x] Создать тестовую страницу для проверки onboarding
- [x] Создать руководство по использованию onboarding
- [x] Добавить кнопку сброса onboarding для разработки
- [x] Интегрировать все компоненты в приложение
- [x] Упростить логику - убрать флаг onboardingCompleted, проверять только по дате рождения
- [x] Исправить форматирование даты - добавить конвертацию в ISO формат для бэкенда

## In Progress Tasks

- [ ] Тестирование onboarding с реальными данными
- [ ] Проверка работы с API endpoints

## Future Tasks

- [ ] Добавить анимации переходов между шагами
- [ ] Добавить прогресс-бар для отображения прогресса
- [ ] Добавить возможность возврата к onboarding из профиля
- [ ] Добавить настройки для администраторов (включение/выключение onboarding)
- [ ] Добавить локализацию для разных языков

## Implementation Plan

### Архитектура

1. **OnboardingModal.vue** - Основной компонент модального окна с 4 шагами
2. **OnboardingManager.vue** - Компонент для управления логикой показа onboarding
3. **Интеграция в App.vue** - Добавление OnboardingManager в главный компонент

### Шаги Onboarding

1. **Шаг 1: Смена пароля**
   - Форма для ввода текущего и нового пароля
   - Валидация паролей
   - API вызов для смены пароля
   - Возможность пропуска

2. **Шаг 2: Личная информация**
   - Форма для ввода имени, фамилии, даты рождения
   - Валидация обязательных полей
   - Сохранение в профиль пользователя
   - Обновление userState

3. **Шаг 3: Фото профиля**
   - Интеграция с ProfileImageCropper
   - Загрузка и кроп изображения
   - Сохранение фото на сервер
   - Возможность пропуска

4. **Шаг 4: Завершение**
   - Приветственное сообщение
   - Описание возможностей сервиса
   - Onboarding автоматически скрывается после заполнения даты рождения

### Relevant Files

- `src/components/OnboardingModal.vue` - ✅ Основной компонент onboarding
- `src/components/OnboardingManager.vue` - ✅ Менеджер onboarding
- `src/App.vue` - ✅ Интеграция в главный компонент
- `src/tools/userState.js` - ✅ Интеграция с состоянием пользователя
- `src/components/ProfileImageCropper.vue` - ✅ Используется для загрузки фото
- `src/views/OnboardingTestView.vue` - ✅ Тестовая страница для проверки
- `src/tools/dateUtils.js` - ✅ Утилиты для форматирования даты
- `src/views/ProfileView.vue` - ✅ Обновлен для правильного форматирования даты

### API Endpoints

- `POST /api/change-password/` - Смена пароля
- `PATCH /users/{id}/` - Обновление данных пользователя
- `GET /users/me/` - Получение данных пользователя

### Логика определения новых пользователей

```javascript
// Проверка в OnboardingManager.vue
const hasBirthDate = user.birthdate && user.birthdate.trim() !== ''

if (hasBirthDate) {
  // Пользователь уже заполнил дату рождения - onboarding не нужен
  return false
} else {
  // Пользователь не заполнил дату рождения - показываем onboarding
  return true
}
``` 