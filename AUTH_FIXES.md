# Исправления системы авторизации

## Проблемы, которые были исправлены:

### 1. Дублирование модальных окон логина
- **Проблема**: В `App.vue` было два компонента для логина - `LoginModal` и `AuthManager`
- **Решение**: Удален дублирующий компонент `LoginModal.vue`, оставлен только `AuthManager`

### 2. Неправильная обработка выхода из системы
- **Проблема**: При выходе пользователь оставался на той же странице без показа модального окна логина
- **Решение**: 
  - Обновлена функция `logoutUser()` для показа модального окна логина
  - Добавлено перенаправление на главную страницу при выходе

### 3. Пустой экран при загрузке
- **Проблема**: Пользователь видел пустой экран во время инициализации приложения
- **Решение**: Добавлен компонент загрузки с анимацией спиннера

### 4. Конфликт между страницей логина и модальным окном
- **Проблема**: Могли показываться одновременно страница логина и модальное окно
- **Решение**: 
  - Обновлен навигационный guard для показа модального окна вместо перенаправления
  - Добавлена обработка события `tokenExpired`

### 5. Проблемы с инициализацией состояния пользователя
- **Проблема**: Состояние пользователя могло не загружаться корректно при старте приложения
- **Решение**: 
  - Улучшена функция `initializeUserState()` с проверкой срока действия токена
  - Добавлена корректная обработка фото пользователя

## Изменения в файлах:

### `src/App.vue`
- Удален дублирующий компонент `LoginModal`
- Добавлен экран загрузки
- Упрощена структура компонента

### `src/tools/auth.js`
- Обновлена функция `logoutUser()` для правильной обработки выхода
- Добавлен параметр `router` для перенаправления

### `src/router/index.js`
- Обновлен навигационный guard для показа модального окна вместо перенаправления
- Добавлена эмиссия события `tokenExpired`

### `src/components/auth/AuthManager.vue`
- Добавлена обработка события `tokenExpired`
- Улучшена логика перенаправления после успешного логина

### `src/tools/userState.js`
- Улучшена функция `initializeUserState()` с проверкой срока действия токена
- Добавлена корректная обработка фото пользователя

## Результат:
- ✅ Устранено дублирование модальных окон
- ✅ Исправлена обработка выхода из системы
- ✅ Добавлен экран загрузки
- ✅ Улучшена инициализация состояния пользователя
- ✅ Исправлены конфликты между страницей логина и модальным окном 